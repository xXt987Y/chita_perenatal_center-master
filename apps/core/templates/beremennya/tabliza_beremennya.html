<div style="border-right-width: 0; border-left-width: 0;" class="tabliza_beremennaya"></div>

<style>


    .stepen_srednia {
        color: orange;
    }

    .stepen_visokia {
        color: red;

    }
</style>

<script>
    'use strict';


    class TablizaBeremennaya {

        constructor($grid, obj_window_beremennya) {
            let self = this;
            this.$grid = $grid;
            this.obj_window_beremennya = obj_window_beremennya;
            this.$window_beremennya = $window_beremennya;
            this.$grid.jqxGrid(self.nastroiki_grida);
            this.$grid.on('rowdoubleclick', function (event) {
                self.otkrit_okno_prosmotra(event);
            });


        }

        get nastroiki_grida() {
            let self = this;
            return {
                width: '100%',
                height: 'calc(100% - 72px)',
                source: this.data_adapter,
                columns: this.colums,
                enabletooltips: true,
                localization: RUS_LOCALIZ,
                filterable: true,
                showtoolbar: true,
                showfilterrow: true,
                pageable: true,
                columnsresize: true,
                autorowheight: true,
                scrollmode: 'logical',
                rowsheight: 40,
                toolbarheight: 40,
                theme: 'arctic',
                altrows: true,
                sortable: true,
                showstatusbar: true,
                statusbarheight: 25,
                pagesizeoptions: ['5', '10', '30', '50', '100'],
                pagesize: 30,
            }
        }

        get fields() {
            return [
                {name: 'id', type: 'number'},
                {name: 'nomer', type: 'number'},
                {name: 'fio', type: 'string'},
                {name: 'otpravitel_title', type: 'string'},
                {name: 'data_rojdeniya_str', type: 'date'},
                {name: 'nomer_oms', type: 'number'},
                {name: 'jk_beremennoy_title', type: 'string'},
                {name: 'stepen_riska_title', type: 'string'},
                {name: 'data_vzyatiya_str', type: 'date'},
                {name: 'mesto_postoyannogo_projivaniya_title', type: 'string'},
                {name: 'jk_beremennoy_title', type: 'string'},
                {name: 'vrach_title', type: 'string'},
                {name: 'mesto_ishoda_title', type: 'string'},
                {name: 'stepen_riska_posle_ishoda_title', type: 'string'},
                {name: 'data_ishoda_str', type: 'date'},

            ]
        }

        get colums() {
            return [
                {
                    text: 'ID',
                    datafield: 'id',
                    align: 'center',
                    cellsalign: 'center',
                    width: '4%',
                    hidecolumn: 'true',
                    hidden: true,
                },
                {
                    text: 'ОМС',
                    datafield: 'nomer_oms',
                    align: 'center',
                    cellsalign: 'center',
                    width: '10%',

                },
                {
                    text: 'ФИО',
                    datafield: 'fio',
                    align: 'center',
                    cellsalign: 'center',
                    width: '16%',

                },
                {
                    text: 'Номер карты',
                    datafield: 'nomer',
                    align: 'center',
                    cellsalign: 'center',
                    width: '15%',

                },

                {
                    text: 'Дата рождения',
                    datafield: 'data_rojdeniya_str',
                    align: 'center',
                    cellsalign: 'center',
                    width: '10%',
                    cellsformat: 'dd.mm.yyyy'


                },
                {
                    text: 'Жк, ведущая беременную',
                    datafield: 'jk_beremennoy_title',
                    align: 'center',
                    cellsalign: 'left',
                    width: '10%',
                    hidden: true,
                },
                {
                    text: 'Степень риска',
                    datafield: 'stepen_riska_title',
                    align: 'center',
                    cellsalign: 'left',
                    width: '10%',
                    cellclassname: function (_row, column, value, data) {
                        let row = data['visibleindex']
                        $($('.tabliza_beremennaya div[role="row"]')[row]).removeClass('stepen_nizkaia stepen_srednia stepen_visokia')
                       if (value === "средняя") {
                            $($('.tabliza_beremennaya div[role="row"]')[row]).addClass("stepen_srednia");
                        }else if (value === "высокая") {
                            $($('.tabliza_beremennaya div[role="row"]')[row]).addClass("stepen_visokia");
                        }
                    },

                },
                {
                    text: 'Дата постановки на учет',
                    datafield: 'data_vzyatiya_str',
                    align: 'center',
                    cellsalign: 'left',
                    width: '15%',
                    cellsformat: 'dd.mm.yyyy',
                    hidden: true,
                },
                {
                    text: 'Место постоянного проживания',
                    datafield: 'mesto_postoyannogo_projivaniya_title',
                    align: 'center',
                    cellsalign: 'left',
                    width: '10%',
                    hidden: true,
                },
                {#{#}
                {#    text: 'Жк ведущая беременную',#}
                {#    datafield: 'jk_beremennoy_title',#}
                {#    align: 'center',#}
                {#    cellsalign: 'left',#}
                {#    width: '5%',#}
                {##}
                {# },#}
                {
                    text: 'Врач',
                    datafield: 'vrach_title',
                    align: 'center',
                    cellsalign: 'left',
                    width: '10%',
                    hidden: true,
                },
                {
                    text: 'Дата исхода',
                    datafield: 'data_ishoda_str',
                    align: 'center',
                    cellsalign: 'center',
                    width: '10%',
                    cellsformat: 'dd.mm.yyyy',
                    hidden: true,
                },
                {
                    text: 'Место исхода',
                    datafield: 'mesto_ishoda_title',
                    align: 'center',
                    cellsalign: 'left',
                    width: '10%',
                    hidden: true,
                },
                {
                    text: 'Степень риска после исхода',
                    datafield: 'stepen_riska_posle_ishoda_title',
                    align: 'center',
                    cellsalign: 'left',
                    width: '10%',
                    hidden: true,
                },
            ];
        }

        get data_adapter() {

            return new $.jqx.dataAdapter({
                datatype: "json",
                data: 'data',
                url: '/api/beremennaya/',
                datafields: this.fields,
                sortcolumn: 'id',
                sortdirection: 'desc'
            });
        }

        otkrit_okno_prosmotra(event) {
            let args = event.args;
            let id = (args.row.bounddata.id);
            BEREMENYA_ID = null;
            {% if user.polzovatel.rol == 2 or user.polzovatel.rol == 3 or user.polzovatel.rol == 4 %}
                $(self.obj_window_beremennya).find('#id_jk_beremennoy').val({{ user.polzovatel.med_organiizaciya.id }});
                $(self.obj_window_beremennya).find('#id_jk_beremennoy').prop("disabled", true);
            {% endif %}
            {#если нет id - значит добавляем. Е#}
            this.obj_window_beremennya.open(id)
            {#open_modal_redaktirovania(id);#}
        }


    }


    let $tabliza_beremennaya = $('.tabliza_beremennaya');
    $(document).ready(function () {
        new TablizaBeremennaya($tabliza_beremennaya, obj_window_beremennya);
    });
    $(".tabliza_beremennaya").jqxGrid('hidecolumn', 'vrach_title');


</script>